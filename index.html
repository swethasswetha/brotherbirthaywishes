<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blow Out The Candle â€” Birthday</title>
<style>
  :root{
    --bg:#7dc9d7;
    --card:#ede2e2;
    --accent:#a667d9;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{
    background: linear-gradient(180deg,#dfeeff 0%,var(--bg) 60%);
    display:flex;align-items:center;justify-content:center;
    overflow:hidden;
  }

  /* Scene container */
  .scene{
    width:100%;
    max-width:900px;
    height:600px;
    position:relative;
    background:linear-gradient(180deg, rgba(240, 140, 140, 0.6), rgba(255,255,255,0.3));
    border-radius:18px;
    box-shadow:0 20px 50px rgba(135, 153, 206, 0.12);
    overflow:hidden;
    display:flex;align-items:center;justify-content:center;
  }

  /* Balloons */
  .balloon {
    position:absolute;
    z-index: 10;
    width:50px;height:70px;
    border-radius:60% 60% 55% 55%;
    bottom:120px;
    left:50%;
    transform:translateX(-50%);
    animation:floatUp 50s linear forwards;
    display:flex;align-items:center;justify-content:center;
    box-shadow: 0 8px 18px rgba(197, 95, 16, 0.12);
  }
  .cord{
    z-index: 5;
  }
  .fly{
    animation: flyup 10s linear forward;
  }
  @keyframes flyup{
    0%{
      bottom: -200px;
    }
    100%{
      bottom: 1000vh;
    }
  }
 .balloon::before{
    content:'';
    position:absolute;
    width:2px;height:60px;
    background:rgba(0,0,0,0.12);
    bottom:-58px;
    left:50%; transform:translateX(-50%);
  }

  /* create many balloons with different colors, positions & timings */
.b1{left:10%; background:linear-gradient(180deg,#ffd6e0,#ff9fb3); animation-duration:9s; animation-delay:0s;}
  .b2{left:25%; background:linear-gradient(180deg,#cfe9ff,#7fc3ff); animation-duration:10s; animation-delay:1s;}
  .b3{left:40%; background:linear-gradient(180deg,#fff3b0,#ffd36b); animation-duration:8.5s; animation-delay:0.5s;}
  .b4{left:60%; background:linear-gradient(180deg,#d3f8d3,#7fe88a); animation-duration:9.8s; animation-delay:0.2s;}
  .b5{left:80%; background:linear-gradient(180deg,#eec9ff,#cda7ff); animation-duration:8.3s; animation-delay:1.6s;}
  @keyframes floatUp{
    0%{transform: translateY(0) rotate(-6deg) scale(0.95); opacity:0}
    10%{opacity:1}
    50%{transform: translateY(-320px) rotate(6deg) scale(1)}
    100%{transform: translateY(-700px) rotate(-6deg) scale(1.05); opacity:0}
  }

  /* Center card where cake appears */
  .card {
    position:relative;
    width:70%;
    height:80%;
    max-width:620px;
    max-height:420px;
    background:var(--card);
    border-radius:14px;
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    box-shadow:0 6px 30px rgba(10,20,40,0.08);
    transition:transform .15s ease-out, opacity .5s ease;
  }

  /* Cake */
  .cake {
    opacity: 0;
    transition: opacity 10s;
    width:200px;
    height:120px;
    position:relative;
    background: saddlebrown;
     border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  }
 *.cake::before {
    content:"";
    position: absolute;
    top:-20px;
    width:200px;
    height:20px;
    background:blanchedalmond;
    border-radius: 50px 50px 0 0;
  }
    .cake .plate{
    width:320px;height:16px;background:#eee;border-radius:10px;position:absolute;bottom:-28px;
  }
* .cake .layer{
    width:200px;height:50px;background:saddlebrown;border-radius:12px;box-shadow:inset 0 6px 12px rgba(255,150,150,0.06);
    display:flex;align-items:center;justify-content:center; flex-direction:column;
  }
  .cake .icing{
    width:100%;height:18px;background:linear-gradient(pink,#d3b3bc,);border-radius:8px 8px 0 0;margin-bottom:6px;
  }
  .candle{
    width:10px;
    height:50px;
    background:#fff5d1;border-radius:3px;position:absolute;
    top: -60px;
    left:50%;
    transform: translate(-50%);
    border-radius: 3px;

    }  .candle .wick{position:absolute;top:6px;width:2px;height:8px;background:#222;border-radius:1px;}
  .flame{
    width:18px;
    height:28px;
    border-radius:50% 50% 50% 50%;
    position:absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    top:-22px;
        transform-origin:center bottom;
    animation:flicker 0.18s infinite;
  }
  .flame .inner{
    width:8px;height:14px;border-radius:50%;background:#ffef5b;position:relative;top:4px;
  }
  .flame.outer{background:linear-gradient(180deg,#ff9b3d,#ffca3d);}
  @keyframes flicker{
   0%{transform: scale(1) translateY(0);}
   50%{transform: scale(1.05) translateY(-1px);}
   100%{transform: scale(0.95) translateY(0);}
  }

  /* Hidden initially */
  .hidden{opacity:0;pointer-events:none;transform:translateY(10px) scale(0.98);}
  .visible{opacity:1;pointer-events:auto;transform:translateY(0) scale(1);}

  /* UI controls area */
  .controls{
    position:absolute;left:12px;top:12px;display:flex;gap:10px;z-index:20;
  }
  .controls button{
    padding:8px 12px;border-radius:8px;border:0;background:#fff;box-shadow:0 6px 18px rgba(10,20,40,0.06);
    cursor:pointer;font-weight:600;
  }

  /* Message overlay after blowing */
  .messageOverlay{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:10;
    background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.12));
    color:white;font-size:24px;font-weight:700;backdrop-filter: blur(2px);
    opacity:0;pointer-events:none;transition:opacity .4s ease;
  }
  .messageOverlay.show{opacity:1;pointer-events:auto;}

  /* small helper text */
  .hint{position:absolute;bottom:12px;left:12px;color:#334; font-weight:600;background:rgba(255,255,255,0.8);padding:8px;border-radius:8px;}
  @media (max-width:600px){
    .scene{height:500px}
    .cake{width:200px;height:120px}
  }
</style>
</head>
<body>
 <h4 style="color: rgb(211, 21, 21);">play this!!!</h4><br><br> 
   <audio controls autoplay style="width: 5cm;height:1cm ;">

                                <source src="Birthday Song Ringtone Download Tamil.mp3" type="audio/mp3 ">
               </audio><br>
               
  <div class="scene" id="scene">
    <!-- controls -->
    <div class="controls">
      <button id="startMicBtn">Enable Mic</button>
      <button id="toggleAlt">Use Click Extinguish</button>
    </div>

    <!-- balloons (floating on load) -->
    <div class="balloon b1"></div>
    <div class="balloon b2"></div>
    <div class="balloon b3"></div>
    <div class="balloon b4"></div>
    <div class="balloon b5"></div>

    <!-- central card (contains cake) -->
    <div class="card visible" id="card">
      <div style="text-align:center;margin-bottom: 80px;">
        <h2 style="margin-top:60 70 16px 0;color: #a667d9;">&#127851; Happy Birthday! &#127882;ðŸŽ‚</h2>
        <h3 style="margin:0 0 10px 0; color:rgb(202, 57, 130);">&#127788; Make a wish and blow the candleðŸ’¨ &#128367; âœ¨</h3>

      </div>

      <!-- cake container -->
      <div class="cake hidden" id="cakeContainer" aria-hidden="true">
        
        <div class="layer">
          <div class="icing"></div>
          <!-- candle sits centered on top -->
          <div style="display:flex;align-items:center;justify-content:center;">
            <div class="candle" id="candle">
            
              <div class="wick"></div>
              <div class="flame outer" id="flame">
                <div class="inner"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="plate"></div>
      </div>

      <!-- small hint -->
      <div class="hint" id="hint">Balloons first... cake in a moment ðŸŽˆ</div>
    </div>

    <!-- message overlay shown after successful blow -->
    <div class="messageOverlay" id="messageOverlay">
      ðŸŽ‰ ðŸ’¨ Happy Birthday Dear BROTHER! ðŸŽ‰
    </div>
  </div>

<script>
/* -------------------------
  Sequence + UI wiring
   - Show balloons immediately (they float via CSS).
   - After a delay (e.g. 4s) hide balloons and show cake.
   - Provide mic-based blow detection (with a button to enable mic).
   - Also provide a click-based fallback (user clicks cake to extinguish).
--------------------------*/

const cakeContainer = document.getElementById('cakeContainer');
const flame = document.getElementById('flame');
const hint = document.getElementById('hint');
const messageOverlay = document.getElementById('messageOverlay');
const startMicBtn = document.getElementById('startMicBtn');
const toggleAlt = document.getElementById('toggleAlt');
const scene = document.getElementById('scene');
let altClickMode = false;

// Step 1: sequence timing: show cake after X seconds, hide balloons
setTimeout(()=> {
  // hide balloons by setting opacity via their class (we simply remove them from view by shrinking)
  document.querySelectorAll('.balloon').forEach(b => b.style.display = 'none');
  // show cake
  cakeContainer.classList.remove('hidden');
  cakeContainer.classList.add('visible');
  hint.textContent = 'Click "Enable Mic" and blow OR click the candle to extinguish';
}, 3800); // 3.8s delay; change as desired

/* -------------------------
  Candle/flame visual helper
--------------------------*/
function extinguishVisual(){
  // animate flame to disappear
  if (!flame) return;
  flame.style.transition = 'transform 0.25s ease, opacity 0.25s ease';
  flame.style.transform = 'scale(0.2) translateY(-4px)';
  flame.style.opacity = '0';
}
function relightVisual(){
  if (!flame) return;
  flame.style.transition = '';
  flame.style.transform = '';
  flame.style.opacity = '1';
}

/* -------------------------
  Message overlay
--------------------------*/
function showMessage(text='âœ¨ðŸ‘»! Happy Birthday  Dear BROTHER!ðŸ‘»\n May all your wishes come true ðŸ˜ŠðŸ’!!\n  stay happy  and blessed  ðŸ¤© ! ðŸŽ‰'){
  messageOverlay.textContent = text;
  messageOverlay.classList.add('show');
  // after some time, hide overlay and optionally relight candle
  setTimeout(()=>{
    messageOverlay.classList.remove('show');
    // optionally relight
    // relightVisual();
  }, 4000);
}

/* -------------------------
  Click fallback: extinguish when user clicks the candle area
--------------------------*/
const candle = document.getElementById('candle');
candle.addEventListener('click', (e)=>{
  if (altClickMode || !window.stream) { // if alt click mode or mic not active, treat click as extinguish
    extinguishVisual();
    showMessage();
  }
});

/* toggleAlt button toggles whether click extinguish is enabled (helpful for devices without mic) */
toggleAlt.addEventListener('click', ()=>{
  altClickMode = !altClickMode;
  toggleAlt.textContent = altClickMode ? 'Click mode: ON' : 'Use Click Extinguish';
  toggleAlt.style.background = altClickMode ? '#ffefef' : '';
});

/* -------------------------
  Microphone / Blow detection
  Simple algorithm:
   - request microphone via getUserMedia
   - connect it to an AnalyserNode
   - compute RMS (volume) from time domain data every 100ms
   - if RMS exceeds threshold and sustained briefly -> consider it a blow
--------------------------*/
let audioContext, analyser, dataArray, sourceNode, rafId;
let blowDetected = false;
let stream = null;
let blowCooldown = false;

startMicBtn.addEventListener('click', async ()=>{
  if (audioContext) return; // already started
  try {
    startMicBtn.textContent = 'Requesting mic...';
    stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    window.stream = stream; // expose for check
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    sourceNode = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    const bufferLength = analyser.fftSize;
    dataArray = new Uint8Array(bufferLength);
    sourceNode.connect(analyser);

    startMicBtn.textContent = 'Mic Enabled';
    startMicBtn.disabled = true;

    // analyze periodically
    let blowAccumulator = 0;
    let framesAbove = 0;
    const sampleInterval = 100; // ms
    const threshold = 0.12; // tuning parameter (RMS normalized 0..1)
    const requiredFrames = 3; // how many consecutive checks above threshold to accept blow

    function analyze(){
      analyser.getByteTimeDomainData(dataArray);
      // compute normalized RMS
      let sum = 0;
      for (let i=0;i<dataArray.length;i++){
        const v = (dataArray[i] - 128) / 128; // -1..1
        sum += v*v;
      }
      const rms = Math.sqrt(sum / dataArray.length); // 0..1
      //console.log('rms',rms);
      if (rms > threshold) {
        framesAbove++;
      } else {
        framesAbove = Math.max(0, framesAbove-1); // decay
      }

      // if sustained above threshold for requiredFrames -> trigger blow
      if (!blowCooldown && framesAbove >= requiredFrames && !blowDetected) {
        blowDetected = true;
        blowCooldown = true;
        // extinguish animation & message
        extinguishVisual();
        showMessage();
        // prevent immediate re-trigger: cooldown
        setTimeout(()=>{ blowCooldown = false; blowDetected=false; }, 3000);
      }

      // loop
      rafId = setTimeout(analyze, sampleInterval);
    }
    analyze();

  } catch (err) {
    console.warn('Mic permission denied or error', err);
    startMicBtn.textContent = 'Mic denied â€” use click';
    startMicBtn.disabled = false;}
});

/* cleanup when page hidden/unloaded */
window.addEventListener('beforeunload', ()=> {
  if (stream) {
    stream.getTracks().forEach(t=>t.stop());
  }
  if (rafId) clearTimeout(rafId);
});
</script>
</body>
</html>
